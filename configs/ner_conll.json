{
    "type": "train_test_log_to_wandb",   
    "dataset_reader":{
        "type": "conll2003",
        "token_indexers":{
            "tokens":{
                "type": "pretrained_transformer_mismatched",
                "max_length":512,
                "model_name": "bert-base-uncased"
            }
        },
        "coding_scheme": "BIOUL",
        "tag_label":"ner"
    },
    "data_loader": {
        "batch_sampler": {
            "type": "bucket",
            "batch_size": 32,
            "sorting_keys": [
                "tokens"
            ]
        }
    },
     "validation_dataset_reader":{
        "type": "conll2003",
        "token_indexers":{
            "tokens":{
                "type": "pretrained_transformer_mismatched",
                "max_length":512,
                "model_name": "bert-base-uncased"
            }
        },
        
        "coding_scheme": "BIOUL",
        "tag_label":"ner"
    },
    "validation_data_loader": {
        "batch_sampler": {
            "type": "bucket",
            "batch_size": 32,
            "sorting_keys": [
                "tokens"
            ]
        }
    },
    "model": {
        "type": "seal-ner",
        "inference_module": {
            "type": "sequence-tagging-inference-net-normalized-custom",
            "log_key": "inference_module",
            "loss_fn": {
                "type": "combination-loss",
                "constituent_losses": [
                    {
                        "log_key": "neg.nce_score",
                        "normalize_y": true,
                        "reduction": "none",
                        "type": "sequence-tagging-score-loss"
                    },
                    {
                        "log_key": "ce",
                        "normalize_y": false,
                        "reduction": "none",
                        "type": "sequence-tagging-masked-cross-entropy"
                    }
                ],
                "log_key": "loss",
                "loss_weights": [
                    0.003497943238599214,
                    1
                ],               
                "reduction": "mean"
            }
        },
        "initializer": {
            "regexes": [
                [
                    ".*feedforward._linear_layers.*weight",
                    {
                        "nonlinearity": "relu",
                        "type": "kaiming_uniform"
                    }
                ],
                [
                    ".*linear_layers.*bias",
                    {
                        "type": "zero"
                    }
                ]
            ]
        },
        "label_encoding": "BIOUL",
        "loss_fn": {
            "type": "seqtag-nce-ranking-with-discrete-sampling",
            "log_key": "seq_nce_loss",
            "num_samples": 100,
            "reduction": "mean"
        },
        "score_nn": {
            "type": "sequence-tagging",
            "global_score": {
                "type": "self-attention-full-sequence",
                "attention_dim": 100,
                "dropout": 0.2,
                "num_heads": 1,
                "num_tags": 17
            },
            "task_nn": {
                "type": "sequence-tagging",
                "text_field_embedder": {
                    "token_embedders": {
                        "tokens": {
                            "max_length":512,
                            "type": "pretrained_transformer_mismatched",
                            "model_name": "bert-base-uncased"
                        }
                    }
                }
            }
        },
        "task_nn": {
            "type": "sequence-tagging",
            "text_field_embedder": {
                "token_embedders": {
                    "tokens": {
                        "max_length":512,
                        "type": "pretrained_transformer",
                        "model_name": "bert-base-uncased"
                    }
                }
            }
        },
        "thresholding": {
            "use_th": false,
            "method": "skip",
            "score_conf": {
                "cut_type": "discrim",
                "quantile": 0.75,
                "score_name": "score",
                "threshold": -100
            }
        },
        "use_pseudo_labeling": false
    },
    "train_data_path":"./data/conll2003ner/train.txt",
    "validation_data_path": "./data/conll2003ner/valid.txt",
    "test_data_path": "./data/conll2003ner/test.txt",
    "trainer": {
        "type": "gradient_descent_minimax",
        "callbacks": [
            "track_epoch_callback",
            "slurm",
            {
                "type": "wandb_allennlp",
                "should_log_parameter_statistics": false,
                "watch_model": false,
                "save_model_archive": false,
                "sub_callbacks": [
                    {
                        "type": "log_best_validation_metric",
                        "priority": 100                        
                    }
                ]
            },
            "thresholding"
        ],
        "checkpointer": {
            "keep_most_recent_by_count": 1,
            "save_every_num_batches": 20000
        },
        "cuda_device": 0,
        "grad_norm": {
            "task_nn": 1
        },
        "inner_mode": "score_nn",
        "learning_rate_schedulers": {
            "task_nn": {
                "type": "reduce_on_plateau",
                "factor": 0.5,
                "mode": "max",
                "patience": 2,
                "verbose": true
            }
        },  
        "num_epochs": 50,
        "num_gradient_accumulation_steps": 2,
        "num_steps": {
            "score_nn": 1,
            "task_nn": 1
        },
        "optimizer": {
            "optimizers": {
                "score_nn": {
                    "type": "adamw",
                    "lr": 2.5436571092962947e-05,
                    "weight_decay": 1e-05
                },
                "task_nn": {
                    "type": "huggingface_adamw",
                    "lr":1.28753143867997e-05,
                    "weight_decay": 1e-05
                }
            }
        },
        "patience": 4,
        "pre_training": 0,
        "validation_metric": "+f1-measure-overall"
    },
    "vocabulary": {
        "type": "from_instances"
    },
    "evaluate_on_test": true,
    "numpy_seed": 2,
    "pytorch_seed": 2,
    "random_seed": 2
}